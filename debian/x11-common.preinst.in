#!/bin/sh
# Debian x11-common package pre-installation script
# Copyright 1998--2001, 2003 Branden Robinson.
# Licensed under the GNU General Public License, version 2.  See the file
# /usr/share/common-licenses/GPL or <http://www.gnu.org/copyleft/gpl.txt>.
# Acknowlegements to Stephen Early, Mark Eichin, and Manoj Srivastava.

set -e

. /usr/share/debconf/confmodule

THIS_PACKAGE=x11-common
THIS_SCRIPT=preinst
CONFIG_DIR=/etc/X11
XWRAPPER_CONFIG="$CONFIG_DIR/Xwrapper.config"
CONFIG_AUX_DIR=/var/lib/x11
XWRAPPER_CONFIG_ROSTER_BASE="${XWRAPPER_CONFIG##*/}.roster"
XWRAPPER_CONFIG_ROSTER="$CONFIG_AUX_DIR/$XWRAPPER_CONFIG_ROSTER_BASE"
XWRAPPER_CONFIG_CHECKSUM_BASE="${XWRAPPER_CONFIG##*/}.md5sum"
XWRAPPER_CONFIG_CHECKSUM="$CONFIG_AUX_DIR/$XWRAPPER_CONFIG_CHECKSUM_BASE"

#INCLUDE_SHELL_LIB#

if [ "$1" = "install" ] || [ "$1" = "upgrade" ]; then

  if dpkg --compare-versions "$2" lt-nl "1:7.4~2ubuntu1"; then
    remove_conffile_lookup xinit "/etc/X11/Xsession.d/20xorg-common_process-args"
    remove_conffile_lookup xinit "/etc/X11/Xsession.d/30xorg-common_xresources"
    remove_conffile_lookup xinit "/etc/X11/Xsession.d/50xorg-common_determine-startup"
    remove_conffile_lookup xinit "/etc/X11/Xsession.d/90xorg-common_ssh-agent"
    remove_conffile_lookup xinit "/etc/X11/Xsession.d/99xorg-common_start"
  fi
  if dpkg --compare-versions "$2" lt-nl "1:7.4~5ubuntu16"; then
    remove_conffile_lookup x11-common "/etc/X11/Xsession.d/60x11-localhost"
  fi

  # create the configuration files' main and auxiliary directories if they
  # don't exist
  for DIR in "$CONFIG_DIR" "$CONFIG_AUX_DIR"; do
    if ! [ -e "$DIR" ]; then
      observe "creating $DIR"
      mkdir --mode=755 --parents "$DIR"
    fi
  done

  # place config files under management if they do *not* already exist
  if ! [ -e "$XWRAPPER_CONFIG" ]; then
    touch "$XWRAPPER_CONFIG"
    md5sum "$XWRAPPER_CONFIG" > "$XWRAPPER_CONFIG_CHECKSUM"
  fi
fi

#DEBHELPER#

exit 0

# vim:set ai et sts=2 sw=2 tw=0:
